<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Interactivo de Probabilidades - Coljuegos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral with Teal Accents -->
    <!-- Application Structure Plan: A dashboard-style SPA. It features a left sidebar for match navigation, filterable by sport (MLB/Fútbol). The main content area on the right displays details for the selected match. This includes a header, key probability visualizations (donut chart for adjusted odds, grouped bar chart for comparing simulated vs. adjusted), and a tabbed interface for detailed textual analysis (Adjustment Summary, Key Factors, Simulation Data). This structure was chosen to manage the high information density per match, preventing user overload and facilitating a clear, focused exploration of the data and the reasoning behind the adjustments. -->
    <!-- Visualization & Content Choices: 
        - Match List (Sidebar): Goal: Organize/Navigate. Method: Dynamic HTML list with JS. Justification: Provides quick, intuitive access to all matches.
        - Adjusted Probability Donut Chart: Goal: Inform. Method: Chart.js Canvas. Justification: Offers an immediate, high-level visual summary of the final adjusted outcome probability for the selected match.
        - Probability Comparison Bar Chart: Goal: Compare. Method: Chart.js Canvas (Grouped Bar). Justification: This is the core visualization, allowing for a detailed, side-by-side comparison of initial (simulated, implicit) vs. final (adjusted) probabilities, highlighting the impact of the analysis.
        - Tabbed Analysis: Goal: Organize/Inform. Method: HTML/CSS/JS. Justification: Breaks down the dense qualitative analysis into digestible, thematic sections, making it easier for the user to understand the 'why' behind the numbers without being overwhelmed by text.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4; /* Warm neutral background */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 40vh;
        }
        .sidebar-item.active {
            background-color: #e6f1f2; /* Light Teal accent */
            color: #0d7377; /* Dark Teal accent */
            font-weight: 600;
        }
        .tab-btn.active {
            border-bottom-color: #32a1a1; /* Teal accent */
            color: #146c70;
        }
        .prose-custom {
            color: #374151;
        }
        .prose-custom h3 {
            color: #111827;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .prose-custom p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        .prose-custom ul {
            list-style-position: inside;
            padding-left: 0;
        }
        .prose-custom li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="flex flex-col md:flex-row h-screen">
        <!-- Sidebar -->
        <aside class="w-full md:w-80 lg:w-96 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col">
            <div class="p-4 border-b border-gray-200">
                <h1 class="text-xl font-bold text-gray-800">Análisis de Partidos</h1>
                <p class="text-sm text-gray-500">23 de Junio, 2025</p>
            </div>
            <div class="p-4 border-b border-gray-200">
                <div class="flex space-x-2">
                    <button id="filter-all" class="flex-1 px-3 py-2 text-sm font-medium text-white bg-[#0d7377] rounded-md shadow-sm">Todos</button>
                    <button id="filter-mlb" class="flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">MLB</button>
                    <button id="filter-futbol" class="flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">Fútbol</button>
                </div>
            </div>
            <div id="match-list" class="overflow-y-auto flex-grow p-2">
                <!-- Match list will be populated by JS -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 bg-[#f8f7f4] p-4 md:p-8 overflow-y-auto">
            <div id="main-content-area">
                <!-- Content will be populated by JS -->
                <div id="match-header" class="mb-6 pb-4 border-b border-gray-300">
                    <h2 id="match-title" class="text-3xl font-bold text-gray-900"></h2>
                    <p id="match-league" class="text-md text-gray-600"></p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Probabilidades Ajustadas Finales</h3>
                    <p class="text-sm text-gray-600 mb-4">
                        Esta visualización muestra la probabilidad de resultado final después de considerar todos los factores de análisis como lesiones, rendimiento reciente y tendencias del mercado.
                    </p>
                    <div class="chart-container h-64 max-h-[300px]">
                        <canvas id="adjustedProbChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                     <h3 class="text-xl font-semibold mb-4 text-gray-800">Comparación de Probabilidades: Simulación vs. Realidad</h3>
                     <p class="text-sm text-gray-600 mb-4">
                        Este gráfico compara las probabilidades de la simulación inicial con las probabilidades implícitas del mercado y el ajuste final del análisis. Permite identificar dónde el análisis experto ha modificado más significativamente la perspectiva inicial.
                    </p>
                    <div class="chart-container h-96 max-h-[450px]">
                        <canvas id="comparisonProbChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Análisis Detallado</h3>
                     <p class="text-sm text-gray-600 mb-4">
                        Explore las diferentes facetas del análisis para entender a fondo la justificación detrás de las probabilidades ajustadas.
                    </p>
                    <div class="border-b border-gray-200">
                        <nav id="tabs" class="-mb-px flex space-x-6">
                           <!-- Tabs will be populated by JS -->
                        </nav>
                    </div>
                    <div id="tab-content" class="pt-6 prose-custom">
                        <!-- Tab content will be populated by JS -->
                    </div>
                </div>
            </div>
             <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center">
                <div class="max-w-2xl">
                    <svg class="mx-auto h-20 w-20 text-[#32a1a1]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h12A2.25 2.25 0 0 0 20.25 14.25V5.25A2.25 2.25 0 0 0 18 3H6A2.25 2.25 0 0 0 3.75 3ZM3.75 14.25v-1.5a1.125 1.125 0 0 1 1.125-1.125h1.5a1.125 1.125 0 0 1 1.125 1.125v1.5m-3.75 0h3.75M9 13.5v-3m-3 3v-3m3 3h3v-3h-3m-3 0h3m9 3.75h.008v.008H18V18Zm-3.75 0h.008v.008h-.008v-.008Zm0 0h.008v.008h-.008v-.008Zm-3.75 0h.008v.008h-.008v-.008Zm0 0h.008v.008h-.008v-.008Z" />
                    </svg>
                    <h2 class="mt-6 text-3xl font-bold tracking-tight text-gray-900">Bienvenido al Analizador de Probabilidades</h2>
                    <p class="mt-4 text-lg text-gray-600">Por favor, seleccione un partido de la lista a la izquierda para comenzar el análisis interactivo.</p>
                </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const matchData = {
        'mlb_orioles_rangers': {
            sport: 'MLB', league: 'MLB', teams: { local: 'Baltimore Orioles', visitor: 'Texas Rangers' },
            probabilities: {
                initial_implied: { local: 57.4, visitor: 42.6 },
                initial_simulated: { local: 59.7, visitor: 27.5, draw: 12.8 },
                adjusted: { local: 49.0, visitor: 51.0 }
            },
            analysis: {
                justification: "La simulación inicial otorga una probabilidad significativamente alta a los Orioles. Sin embargo, la grave situación de lesiones en su cuerpo de lanzadores, incluyendo varios abridores clave y a su receptor estrella Adley Rutschman, no parece estar completamente reflejada. La predicción de expertos que favorece a los Rangers y las cuotas de mercado más ajustadas refuerzan la idea de que la probabilidad de los Orioles podría estar inflada. El ajuste acerca el resultado a un partido más equilibrado.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Lesiones Orioles:</b> Kyle Bradish, Grayson Rodriguez, Tyler Wells (abridores), Albert Suarez (relevista), y el receptor Adley Rutschman están fuera. Esto afecta gravemente la profundidad del pitcheo.</li><li><b>Lesiones Rangers:</b> Jon Gray (abridor), Jake Burger (1B) y Cody Bradford (relevista) en la lista de lesionados.</li><li><b>Análisis de Expertos:</b> Una predicción de Bleacher Nation sugiere una victoria de los Rangers 6-5.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Carreras Totales:</b> 9.6</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>5-4 (frecuencia: 41/1000)</li><li>5-3 (frecuencia: 39/1000)</li><li>4-4 (frecuencia: 39/1000)</li></ul>"
            }
        },
        'mlb_braves_mets': {
            sport: 'MLB', league: 'MLB', teams: { local: 'Atlanta Braves', visitor: 'New York Mets' },
            probabilities: {
                initial_implied: { local: 58.2, visitor: 41.8 },
                initial_simulated: { local: 64.3, visitor: 24.2, draw: 11.5 },
                adjusted: { local: 50.0, visitor: 50.0 }
            },
            analysis: {
                justification: "La simulación asigna una probabilidad muy alta a los Braves. Sin embargo, la lesión de su lanzador as, Chris Sale, es un factor de gran peso que la simulación probablemente no ha incorporado en su totalidad. Aunque el abridor de los Mets, Paul Blackburn, ha tenido dificultades, la pérdida de un as como Sale tiene un impacto sustancial y hace el partido mucho más competitivo de lo que se sugiere inicialmente.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Lesión Clave Braves:</b> El lanzador as Chris Sale, ganador del Cy Young 2024, está en la lista de lesionados por 15 días. Su ausencia es un 'golpe brutal' para el equipo.</li><li><b>Duelo de Lanzadores:</b> Spencer Schwellenbach (Braves) tiene un ERA de 3.26, mientras que Paul Blackburn (Mets) ha tenido un ERA de 6.92 en sus últimas apariciones.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Carreras Totales:</b> 8.5</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>5-4 (frecuencia: 41/1000)</li><li>4-3 (frecuencia: 37/1000)</li><li>5-3 (frecuencia: 34/1000)</li></ul>"
            }
        },
        'mlb_reds_yankees': {
            sport: 'MLB', league: 'MLB', teams: { local: 'Cincinnati Reds', visitor: 'New York Yankees' },
            probabilities: {
                initial_implied: { local: 49.3, visitor: 50.7 },
                initial_simulated: { local: 44.0, visitor: 43.3, draw: 12.7 },
                adjusted: { local: 48.0, visitor: 52.0 }
            },
            analysis: {
                justification: "Las probabilidades implícitas y simuladas sugieren un partido muy parejo. A pesar de las numerosas lesiones en el pitcheo de ambos equipos, el récord general superior de los Yankees (44-32 vs 39-38 de los Reds) y su sólido desempeño como favoritos (42-26) sugieren que su probabilidad de victoria podría estar ligeramente subestimada por la simulación. El ajuste les da una ligera ventaja.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Lesiones Pitcheo Yankees:</b> Gerrit Cole (fuera por la temporada), Luis Gil y JT Brubaker están lesionados.</li><li><b>Lesiones Pitcheo Reds:</b> Brandon Williamson, Julian Aguiar (fuera por la temporada), Rhett Lowder y Graham Ashcraft están lesionados.</li><li><b>Récord General:</b> Los Yankees tienen un mejor récord general.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Carreras Totales:</b> 9.6</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>4-5 (frecuencia: 31/1000)</li><li>4-4 (frecuencia: 29/1000)</li><li>5-5 (frecuencia: 28/1000)</li></ul>"
            }
        },
        'mlb_whitesox_dbacks': {
            sport: 'MLB', league: 'MLB', teams: { local: 'Chicago White Sox', visitor: 'Arizona Diamondbacks' },
            probabilities: {
                initial_implied: { local: 43.5, visitor: 56.5 },
                initial_simulated: { local: 27.5, visitor: 59.1, draw: 13.4 },
                adjusted: { local: 29.0, visitor: 71.0 }
            },
            analysis: {
                justification: "La simulación favorece fuertemente a los Diamondbacks, y el análisis externo lo confirma. La disparidad en el rendimiento es notable: los White Sox tienen un récord muy pobre (24-53), una ofensiva débil (puesto 28 en carreras) y un bullpen mediocre. Los Diamondbacks, en cambio, tienen una ofensiva potente (3er lugar en carreras) y su lanzador abridor, Eduardo Rodríguez, ha mostrado mejoría reciente. Se justifica una fuerte inclinación hacia los D-backs.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Rendimiento White Sox:</b> Récord muy negativo (24-53), bullpen en el puesto 21 de ERA, ofensiva en el puesto 28.</li><li><b>Rendimiento D-backs:</b> Ofensiva potente (3er lugar en carreras), récord de 39-37.</li><li><b>Lanzador D-backs:</b> Eduardo Rodríguez ha mejorado, permitiendo 2 o menos carreras en sus últimas 3 aperturas.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Carreras Totales:</b> 8.7</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>3-5 (frecuencia: 41/1000)</li><li>4-5 (frecuencia: 38/1000)</li><li>3-6 (frecuencia: 36/1000)</li></ul>"
            }
        },
         'futbol_seattle_psg': {
            sport: 'Fútbol', league: 'Mundial de Clubes (FIFA)', teams: { local: 'Seattle Sounders', visitor: 'PSG' },
            probabilities: {
                initial_implied: { local: 4.4, draw: 11.5, visitor: 84.1 },
                initial_simulated: { local: 1.5, draw: 11.2, visitor: 87.3 },
                adjusted: { local: 1.0, draw: 9.0, visitor: 90.0 }
            },
            analysis: {
                justification: "Tanto las probabilidades implícitas como las simuladas favorecen abrumadoramente al PSG. El análisis cualitativo confirma una 'brecha sísmica' en calidad entre los dos equipos. A pesar de una derrota previa que sirvió como 'llamada de atención', se espera que el PSG, campeón de la Champions League, domine. La motivación del PSG y las múltiples lesiones de los Sounders justifican una probabilidad de victoria aún mayor para el equipo parisino.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Calidad de Equipo:</b> El PSG es el campeón de la UEFA Champions League.</li><li><b>Motivación:</b> Una derrota previa podría aumentar la concentración del PSG.</li><li><b>Lesiones Seattle:</b> Los Sounders tienen múltiples preocupaciones por lesiones y necesitan una victoria improbable por 3 goles para avanzar.</li><li><b>Lesiones PSG:</b> Ousmané Dembélé está lesionado, pero jugadores clave como Nuno Mendes y Marquinhos regresan.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Goles Totales:</b> 2.51</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>0-2 (frecuencia: 111/1000)</li><li>0-1 (frecuencia: 101/1000)</li><li>0-3 (frecuencia: 98/1000)</li></ul>"
            }
        },
        'futbol_atletico_botafogo': {
            sport: 'Fútbol', league: 'Mundial de Clubes (FIFA)', teams: { local: 'Atlético de Madrid', visitor: 'Botafogo' },
            probabilities: {
                initial_implied: { local: 59.6, draw: 24.3, visitor: 16.1 },
                initial_simulated: { local: 68.6, draw: 22.6, visitor: 8.8 },
                adjusted: { local: 60.0, draw: 28.0, visitor: 12.0 }
            },
            analysis: {
                justification: "La simulación favorece fuertemente al Atlético, más que las probabilidades implícitas. Sin embargo, la excelente forma de Botafogo, destacando su 'actuación defensiva monstruosa' en la victoria 1-0 sobre el PSG, es un factor crucial que la simulación podría haber subestimado. La necesidad del Atlético de ganar por goleada choca con el enfoque táctico típicamente cauto de Simeone. Esto sugiere que la probabilidad de victoria del Atlético está sobrevalorada en la simulación.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Forma Botafogo:</b> Vienen de 5 victorias consecutivas, incluyendo una portería a cero contra el PSG.</li><li><b>Táctica Atlético:</b> A pesar de necesitar 3 goles para clasificar, no se espera que Simeone opte por una alineación 'súper agresiva'.</li><li><b>Regresos Atlético:</b> Antoine Griezmann probablemente regresará a la alineación titular.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Goles Totales:</b> 2.04</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>1-0 (frecuencia: 173/1000)</li><li>2-0 (frecuencia: 149/1000)</li><li>0-0 (frecuencia: 111/1000)</li></ul>"
            }
        },
        'futbol_city_alain': {
            sport: 'Fútbol', league: 'Mundial de Clubes (FIFA)', teams: { local: 'Manchester City', visitor: 'Al Ain FC' },
            probabilities: {
                initial_implied: { local: 85.5, draw: 9.5, visitor: 5.0 },
                initial_simulated: { local: 85.7, draw: 12.4, visitor: 1.9 },
                adjusted: { local: 89.0, draw: 9.0, visitor: 2.0 }
            },
            analysis: {
                justification: "Las probabilidades favorecen abrumadoramente al Manchester City. La capacidad del City para rotar 11 jugadores y aun así ganar por un amplio margen en su partido anterior, mientras que Al Ain perdió 5-0 contra la Juventus, confirma su superioridad masiva. Las probabilidades simuladas para Al Ain son muy bajas y parecen justificadas; el ajuste incluso aumenta ligeramente la probabilidad del City.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Profundidad Plantilla City:</b> El equipo rotó 11 jugadores y ganó de forma convincente, con jugadores como Claudio Echeverri y Oscar Bobb impresionando.</li><li><b>Forma Reciente Al Ain:</b> Perdieron su partido anterior por 5-0.</li><li><b>Calidad General:</b> Existe una brecha de calidad inmensa entre ambos equipos.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Goles Totales:</b> 2.49</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>2-0 (frecuencia: 131/1000)</li><li>3-0 (frecuencia: 121/1000)</li><li>1-0 (frecuencia: 99/1000)</li></ul>"
            }
        },
        'futbol_operario_novo': {
            sport: 'Fútbol', league: 'Brasileirão Série B (Brasil)', teams: { local: 'Operário Ferroviário', visitor: 'Grêmio Novorizontino' },
            probabilities: {
                initial_implied: { local: 54.8, draw: 24.3, visitor: 20.9 },
                initial_simulated: { local: 57.7, draw: 28.1, visitor: 14.2 },
                adjusted: { local: 35.0, draw: 30.0, visitor: 35.0 }
            },
            analysis: {
                justification: "La simulación otorga a Operário una probabilidad de victoria muy alta. Sin embargo, la forma reciente de Novorizontino es excepcional (5 victorias seguidas, diferencia de goles de 10:1, 2do en la tabla), mientras que Operário tiene un récord perdedor. El historial de enfrentamientos directos también favorece a Novorizontino. La simulación parece subestimar masivamente a Novorizontino, por lo que el ajuste equilibra el partido, reflejando la excelente forma del visitante.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Forma Novorizontino:</b> Excepcional, con 5 victorias consecutivas y ocupando el 2do lugar en la Serie B.</li><li><b>Forma Operário:</b> Récord general de 4 victorias, 2 empates y 6 derrotas.</li><li><b>H2H:</b> El historial de enfrentamientos directos favorece a Novorizontino.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Goles Totales:</b> 2.04</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>1-0 (frecuencia: 153/1000)</li><li>0-0 (frecuencia: 141/1000)</li><li>2-0 (frecuencia: 111/1000)</li></ul>"
            }
        },
        'futbol_everton_ohiggins': {
            sport: 'Fútbol', league: 'Primera División de Chile', teams: { local: 'Everton', visitor: "O'Higgins" },
            probabilities: {
                initial_implied: { local: 37.0, draw: 29.9, visitor: 33.1 },
                initial_simulated: { local: 41.4, draw: 30.4, visitor: 28.2 },
                adjusted: { local: 0.0, draw: 0.0, visitor: 100.0 }
            },
            analysis: {
                justification: "El informe de simulación es para el 23 de junio de 2025. Los datos de fuentes externas indican que el partido ya se jugó en esa fecha, con un resultado final de Everton 0-1 O'Higgins. Dado que el resultado del partido ya se conoce, las probabilidades ajustadas deben reflejar el resultado real, anulando cualquier cálculo predictivo.",
                factors: "<h3>Factores Clave:</h3><ul><li><b>Resultado Real:</b> El partido ya se jugó y el resultado fue 0-1 a favor de O'Higgins.</li></ul>",
                sim_data: "<h3>Datos de Simulación Inicial:</h3><p><b>Promedio de Goles Totales:</b> 1.83</p><p><b>Resultados más probables (Local-Visitante):</b></p><ul><li>1-1 (frecuencia: 139/1000)</li><li>1-0 (frecuencia: 131/1000)</li><li>0-0 (frecuencia: 121/1000)</li></ul>"
            }
        }
    };

    let adjustedProbChart = null;
    let comparisonProbChart = null;
    const mainContentArea = document.getElementById('main-content-area');
    const welcomeScreen = document.getElementById('welcome-screen');

    function initializeApp() {
        populateMatchList();
        setupFilters();
        mainContentArea.style.display = 'none';
        welcomeScreen.style.display = 'flex';
    }

    function populateMatchList(filter = 'all') {
        const listContainer = document.getElementById('match-list');
        listContainer.innerHTML = '';
        
        const leagues = {};
        Object.keys(matchData).forEach(id => {
            const match = matchData[id];
            if (filter === 'all' || match.sport.toLowerCase() === filter) {
                if (!leagues[match.league]) {
                    leagues[match.league] = [];
                }
                leagues[match.league].push({ id, ...match });
            }
        });

        Object.keys(leagues).sort().forEach(league => {
            const leagueHeader = document.createElement('h3');
            leagueHeader.className = 'px-2 pt-4 pb-1 text-sm font-semibold text-gray-500';
            leagueHeader.textContent = league;
            listContainer.appendChild(leagueHeader);

            leagues[league].forEach(match => {
                const item = document.createElement('a');
                item.href = '#';
                item.className = 'sidebar-item block px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 rounded-md transition-colors duration-150';
                item.textContent = `${match.teams.local} vs ${match.teams.visitor}`;
                item.dataset.matchId = match.id;
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderMatchDetails(match.id);
                    document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                });
                listContainer.appendChild(item);
            });
        });
    }
    
    function setupFilters() {
        const filters = {
            'all': document.getElementById('filter-all'),
            'mlb': document.getElementById('filter-mlb'),
            'futbol': document.getElementById('filter-futbol')
        };
        
        Object.keys(filters).forEach(key => {
            filters[key].addEventListener('click', () => {
                populateMatchList(key);
                Object.values(filters).forEach(btn => btn.classList.remove('bg-[#0d7377]', 'text-white'));
                Object.values(filters).forEach(btn => btn.classList.add('bg-gray-100', 'text-gray-700'));
                filters[key].classList.add('bg-[#0d7377]', 'text-white');
                filters[key].classList.remove('bg-gray-100', 'text-gray-700');
            });
        });
    }

    function renderMatchDetails(matchId) {
        welcomeScreen.style.display = 'none';
        mainContentArea.style.display = 'block';

        const data = matchData[matchId];
        document.getElementById('match-title').textContent = `${data.teams.local} vs ${data.teams.visitor}`;
        document.getElementById('match-league').textContent = data.league;
        
        renderTabs(matchId);
        renderAdjustedProbChart(data);
        renderComparisonChart(data);
    }
    
    function renderTabs(matchId) {
        const data = matchData[matchId];
        const tabsContainer = document.getElementById('tabs');
        const tabContentContainer = document.getElementById('tab-content');

        tabsContainer.innerHTML = `
            <button class="tab-btn p-4 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 active" data-tab="justification">Resumen del Ajuste</button>
            <button class="tab-btn p-4 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="factors">Factores Clave</button>
            <button class="tab-btn p-4 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="sim_data">Datos de Simulación</button>
        `;
        tabContentContainer.innerHTML = data.analysis.justification;

        tabsContainer.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                tabsContainer.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                tabContentContainer.innerHTML = data.analysis[btn.dataset.tab];
            });
        });
    }

    function renderAdjustedProbChart(data) {
        const ctx = document.getElementById('adjustedProbChart').getContext('2d');
        if (adjustedProbChart) {
            adjustedProbChart.destroy();
        }

        const adjustedProbs = data.probabilities.adjusted;
        const labels = Object.keys(adjustedProbs).map(k => {
            if (k === 'local') return data.teams.local;
            if (k === 'visitor') return data.teams.visitor;
            return 'Empate';
        });
        const chartData = Object.values(adjustedProbs);
        
        adjustedProbChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Probabilidad Ajustada',
                    data: chartData,
                    backgroundColor: ['#32a1a1', '#e6f1f2', '#146c70'],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw.toFixed(1)}%`;
                            }
                        }
                    }
                }
            }
        });
    }

    function renderComparisonChart(data) {
        const ctx = document.getElementById('comparisonProbChart').getContext('2d');
        if (comparisonProbChart) {
            comparisonProbChart.destroy();
        }

        const { initial_implied, initial_simulated, adjusted } = data.probabilities;
        const isMlb = data.sport === 'MLB';
        
        let local_sim = initial_simulated.local;
        let visitor_sim = initial_simulated.visitor;

        if (isMlb && initial_simulated.draw > 0) {
            const totalWinProb = local_sim + visitor_sim;
            if (totalWinProb > 0) {
                local_sim += (local_sim / totalWinProb) * initial_simulated.draw;
                visitor_sim += (visitor_sim / totalWinProb) * initial_simulated.draw;
            }
        }
        
        const labels = [data.teams.local, data.teams.visitor];
        if (!isMlb) {
            labels.push('Empate');
        }

        const datasets = [
            {
                label: 'Prob. Simulada',
                data: isMlb ? [local_sim, visitor_sim] : [initial_simulated.local, initial_simulated.visitor, initial_simulated.draw],
                backgroundColor: '#e6f1f2',
                borderColor: '#cddce0',
                borderWidth: 1
            },
            {
                label: 'Prob. Implícita',
                data: isMlb ? [initial_implied.local, initial_implied.visitor] : [initial_implied.local, initial_implied.visitor, initial_implied.draw],
                backgroundColor: '#32a1a1',
                borderColor: '#2a8a8a',
                borderWidth: 1
            },
            {
                label: 'Prob. Ajustada',
                data: isMlb ? [adjusted.local, adjusted.visitor] : [adjusted.local, adjusted.visitor, adjusted.draw],
                backgroundColor: '#146c70',
                borderColor: '#105659',
                borderWidth: 1
            }
        ];
        
        comparisonProbChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Probabilidad (%)'
                        }
                    }
                },
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw.toFixed(1)}%`;
                            }
                        }
                    },
                    subtitle: {
                        display: isMlb,
                        text: 'Nota: La probabilidad de "Empate" de la simulación de MLB se ha redistribuido.',
                        padding: {
                            bottom: 10
                        }
                    }
                }
            }
        });
    }

    initializeApp();
});
</script>

</body>
</html>
